<template>
  <div class="contentBox" style="overflow-x: hidden">
    <div class="cal">
      <p>ç¢³æ’æ”¾å¤§äºç¢³å¸æ”¶çš„ç³»ç»Ÿä¸ºç¢³æºï¼Œåä¹‹åˆ™ä¸ºç¢³æ±‡ã€‚</p>
      <p>ç¢³æ’æ”¾è®¡ç®—å…¬å¼ï¼šEt=Gf*a+Am+b+Wm*c+Gs*d+Gi*e+Ge*f+Gp*g</p>
      <p>
        Gf:åŒ–è‚¥ä½¿ç”¨é‡;Am:å†œä½œç‰©ç§æ¤é¢ç§¯;Wm:å†œä¸šæœºæ¢°æ€»åŠ¨åŠ›;Gs:å†œç”¨æŸ´æ²¹;Gi:å†œä¸šçŒæº‰é¢ç§¯;Ge:å†œè†œä½¿ç”¨é¢ç§¯;Gp:å†œè¯ä½¿ç”¨é‡
      </p>
      <p>
        aã€bã€cã€dã€eã€fã€gï¼šè½¬æ¢ç³»æ•°ï¼Œæ•°å€¼åˆ†åˆ«ä¸º0.8956kg/kgã€16.47kg/â„ğ‘š<sup>2</sup>ã€0.18kg/kWã€0.5927kg/kgã€266.48kg/â„ğ‘š<sup>2</sup>ã€5.18kg/kgã€4.9341kg/kg
      </p>
      <p>å†œä½œç‰©å¤§æ°”å›ºç¢³è®¡ç®—å…¬å¼ï¼šCt=&sum;Cf*Yw/Hi</p>
      <p>Cf:iç±»å†œä½œç‰©ç¢³å¸æ”¶ç‡;Yw:iç±»å†œä½œç‰©ç»æµäº§é‡;Hi:iç±»å†œä½œç‰©ç»æµç³»æ•°</p>
      <div class="boxall" style="height: calc(33.333% - 0.15rem)">
        <div class="alltitle">å†œä½œç‰©ç¢³å¸æ”¶ç‡ä¸ç»æµç³»æ•°è¡¨(å•ä½:ä¸‡å¨)</div>
        <div class="boxnav" id="">
          <table border="3" cellspacing="1">
            <tbody>
              <tr style="border: 2px">
                <th style="border: 2px"></th>
                <th style="border: 2px">è”¬èœ</th>
                <th style="border: 2px">æ°´ç¨»</th>
                <th style="border: 2px">å°éº¦</th>
                <th style="border: 2px">ç‰ç±³</th>
                <th style="border: 2px">è–¯ç±»</th>
                <th style="border: 2px">å¤§è±†</th>
                <th style="border: 2px">èŠ±ç”Ÿ</th>
                <th style="border: 2px">æ²¹èœ</th>
              </tr>
              <tr>
                <th>ç»æµç³»æ•°</th>
                <td>0.600</td>
                <td>0.450</td>
                <td>0.400</td>
                <td>0.400</td>
                <td>0.700</td>
                <td>0.340</td>
                <td>0.430</td>
                <td>0.250</td>
              </tr>
              <tr>
                <th>ç¢³å¸æ”¶ç‡</th>
                <td>0.450</td>
                <td>0.414</td>
                <td>0.485</td>
                <td>0.471</td>
                <td>0.423</td>
                <td>0.450</td>
                <td>0.450</td>
                <td>0.450</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <p>å‡€ç¢³æ±‡è®¡ç®—å…¬å¼ï¼šNt=Ct-Et</p>
      <p>Nt:å†œç”°ç”Ÿæ€ç³»ç»Ÿçš„å‡€ç¢³æ±‡;Ct:ç¢³å¸æ”¶é‡;Et:ç¢³æ’æ”¾é‡</p>
      <p>
        ç¢³æ’æ”¾å¼ºåº¦ã€ç¢³å¸æ”¶å¼ºåº¦åŠå‡€ç¢³æ±‡å¼ºåº¦çš„å€¼åˆ†åˆ«ç­‰äºç¢³æ’æ”¾é‡ã€ç¢³å¸æ”¶é‡åŠå‡€ç¢³æ±‡é‡é™¤ä»¥è€•åœ°é¢ç§¯ã€‚
      </p>
    </div>

    <div id="app">
      <div
        style="
          width: 30%;
          text-align: center;
          margin-top: 10px;
          margin-bottom: 60px;
        "
      >
        <div style="width: 20%; float: right">
          <el-button
            slot="append"
            style="color: #0b5ed7"
            @click="dialogFormVisible1 = true"
            >ç¢³æ±‡è®¡ç®—</el-button
          >
        </div>
        <div style="float: left; width: 80%">
          <el-input v-model="input" placeholder="è¯·è¾“å…¥å†œä½œç‰©åç§°">
            <el-button
              size="mini"
              slot="append"
              style="color: #0b5ed7"
              @click="mohuSearch"
              >æŸ¥è¯¢</el-button
            >
          </el-input>
        </div>
      </div>

      <el-table
        :data="listData"
        style="
          width: 100%;
          margin-top: 10px;
          margin-left: 5px;
          border-radius: 5px;
        "
        max-height="80%"
      >
        <el-table-column fixed label="#" width="80" prop="cropId">
        </el-table-column>
        <el-table-column label="å†œä½œç‰©å" width="120" prop="cropName">
        </el-table-column>
        <el-table-column label="æœˆä»½" width="80" prop="month">
        </el-table-column>
        <el-table-column
          label="ç¢³æ’æ”¾å¼ºåº¦(åƒå…‹/å…¬é¡·)"
          width="120"
          prop="emissionIntensity"
        >
        </el-table-column>
        <el-table-column
          label="ç¢³å¸æ”¶å¼ºåº¦(åƒå…‹/å…¬é¡·)"
          width="120"
          prop="absorptionIntensity"
        >
        </el-table-column>
        <el-table-column
          label="å‡€ç¢³æ±‡å¼ºåº¦(åƒå…‹/å…¬é¡·)"
          width="120"
          prop="carbonSink"
        >
        </el-table-column>
        <!--------------------------------------ç¼–è¾‘åˆ é™¤æŒ‰é’®------------------------------------------------>
        <el-table-column fixed="right" label="æ“ä½œ" width="400">
          <template slot-scope="scope">
            <el-button
              size="mini"
              @click="
                (dialogFormVisible = true), handleEdit(scope.$index, scope.row)
              "
              >æ–°æ•°æ®åˆ†æ</el-button
            >
            <el-button
              size="mini"
              type="danger"
              plain
              @click="deletes(scope.row)"
              icon="el-icon-delete"
              >åˆ é™¤</el-button
            >
          </template>
        </el-table-column>
      </el-table>
      <div
        style="
          width: 100%;
          margin-top: 10px;
          margin-left: 35%;
          border-radius: 3px;
        "
      >
        <el-button size="mini" @click="upt()">ä¸Šä¸€é¡µ</el-button>

        <el-button size="mini" @click="next()">ä¸‹ä¸€é¡µ</el-button>
      </div>
      <!--------------------------------------ç¼–è¾‘èœå“------------------------------------------------>
      <el-dialog title="æ›´æ–°ç¢³æ±‡æ•°æ®" :visible.sync="dialogFormVisible">
        <el-form :model="up">
          <el-form-item label=" " :label-width="formLabelWidth">
            <el-input
              v-model="up.cropId"
              autocomplete="off"
              disabled="true"
            ></el-input>
          </el-form-item>
          <el-form-item label="å†œä½œç‰©åç§°" :label-width="formLabelWidth">
            <el-input v-model="up.cropName" autocomplete="off"></el-input>
          </el-form-item>
          <el-form-item label="æœˆä»½" :label-width="formLabelWidth">
            <el-input v-model="up.month" autocomplete="off"></el-input>
          </el-form-item>
          <el-form-item label="åŒ–è‚¥ä½¿ç”¨é‡(åƒå…‹)" :label-width="formLabelWidth">
            <el-input v-model="up.fertilizer" autocomplete="off"></el-input>
          </el-form-item>
          <el-form-item label="å†œè¯ä½¿ç”¨é‡(åƒå…‹)" :label-width="formLabelWidth">
            <el-input v-model="up.pesticide" autocomplete="off"></el-input>
          </el-form-item>
          <el-form-item
            label="å†œä½œç‰©ç§æ¤é¢ç§¯(å…¬é¡·)"
            :label-width="formLabelWidth"
          >
            <el-input v-model="up.area" autocomplete="off"></el-input>
          </el-form-item>
          <el-form-item
            label="å†œä¸šçŒæº‰é¢ç§¯(å…¬é¡·)"
            :label-width="formLabelWidth"
          >
            <el-input v-model="up.irrigate" autocomplete="off"></el-input>
          </el-form-item>
          <el-form-item
            label="å†œè†œä½¿ç”¨é¢ç§¯(å…¬é¡·)"
            :label-width="formLabelWidth"
          >
            <el-input v-model="up.film" autocomplete="off"></el-input>
          </el-form-item>
          <el-form-item
            label="å†œä¸šæœºæ¢°æ€»åŠ¨åŠ›(åƒç“¦)"
            :label-width="formLabelWidth"
          >
            <el-input v-model="up.Wm" autocomplete="off"></el-input>
          </el-form-item>
          <el-form-item
            label="å†œç”¨æŸ´æ²¹ä½¿ç”¨é‡(åƒç“¦)"
            :label-width="formLabelWidth"
          >
            <el-input v-model="up.Gs" autocomplete="off"></el-input>
          </el-form-item>
          <el-form-item label="å†œä½œç‰©ç»æµç³»æ•°" :label-width="formLabelWidth">
            <el-input v-model="up.coefficient" autocomplete="off"></el-input>
          </el-form-item>
          <el-form-item label="å†œä½œç‰©ç¢³å¸æ”¶ç‡" :label-width="formLabelWidth">
            <el-input v-model="up.absorption" autocomplete="off"></el-input>
          </el-form-item>
          <el-form-item
            label="å†œä½œç‰©ç»æµäº§é‡(åƒå…‹)"
            :label-width="formLabelWidth"
          >
            <el-input v-model="up.output" autocomplete="off"></el-input>
          </el-form-item>
        </el-form>
        <div slot="footer" class="dialog-footer">
          <el-button @click="dialogFormVisible = false">å– æ¶ˆ</el-button>
          <el-button type="primary" v-on:click="updates()">æäº¤</el-button>
        </div>
        <!--------------------------------------æ·»åŠ èœå“------------------------------------------------>
      </el-dialog>
      <el-dialog title="è¾“å…¥è®¡ç®—å‚æ•°" :visible.sync="dialogFormVisible1">
        <el-form :model="add">
          <el-form-item label="å†œä½œç‰©åç§°" :label-width="formLabelWidth">
            <el-input v-model="add.cropName" autocomplete="off"></el-input>
          </el-form-item>
          <el-form-item label="æœˆä»½" :label-width="formLabelWidth">
            <el-input v-model="add.month" autocomplete="off"></el-input>
          </el-form-item>
          <el-form-item label="åŒ–è‚¥ä½¿ç”¨é‡(kg)" :label-width="formLabelWidth">
            <el-input v-model="add.fertilizer" autocomplete="off"></el-input>
          </el-form-item>
          <el-form-item label="å†œè¯ä½¿ç”¨é‡(kg)" :label-width="formLabelWidth">
            <el-input v-model="add.pesticide" autocomplete="off"></el-input>
          </el-form-item>
          <el-form-item label="ç§æ¤é¢ç§¯(hm2)" :label-width="formLabelWidth">
            <el-input v-model="add.area" autocomplete="off"></el-input>
          </el-form-item>
          <el-form-item label="çŒæº‰é¢ç§¯(kg)" :label-width="formLabelWidth">
            <el-input v-model="add.irrigate" autocomplete="off"></el-input>
          </el-form-item>
          <el-form-item label="å†œè†œé¢ç§¯(kg)" :label-width="formLabelWidth">
            <el-input v-model="add.film" autocomplete="off"></el-input>
          </el-form-item>
          <el-form-item label="æœºæ¢°æ€»åŠ¨åŠ›(kw)" :label-width="formLabelWidth">
            <el-input v-model="add.Wm" autocomplete="off"></el-input>
          </el-form-item>
          <el-form-item label="æŸ´æ²¹ä½¿ç”¨é‡(kw)" :label-width="formLabelWidth">
            <el-input v-model="add.Gs" autocomplete="off"></el-input>
          </el-form-item>
          <el-form-item label="å†œä½œç‰©ç»æµç³»æ•°" :label-width="formLabelWidth">
            <el-input v-model="add.coefficient" autocomplete="off"></el-input>
          </el-form-item>
          <el-form-item label="å†œä½œç‰©ç¢³å¸æ”¶ç‡" :label-width="formLabelWidth">
            <el-input v-model="add.absorption" autocomplete="off"></el-input>
          </el-form-item>
          <el-form-item
            label="å†œä½œç‰©ç»æµäº§é‡(kg)"
            :label-width="formLabelWidth"
          >
            <el-input v-model="add.output" autocomplete="off"></el-input>
          </el-form-item>
        </el-form>
        <div slot="footer" class="dialog-footer">
          <el-button
            @click="
              dialogFormVisible1 = false;
              resetForm('add');
            "
            >å– æ¶ˆ</el-button
          >
          <el-button type="primary" @click="submitf">æäº¤</el-button>
        </div>
      </el-dialog>
    </div>
  </div>
</template>

<script>
import axios from "axios";
export default {
  name: "calculatePages",
  data() {
    return {
      info: [],
      a: 0.8956,
      b: 16.47,
      c: 266.48,
      d: 5.18,
      e: 4.9341,
      f: 0.18,
      g: 0.5927,
      add: {
        cropName: "å°éº¦",
        month: "3æœˆä»½",
        fertilizer: "",
        pesticide: "",
        area: "",
        irrigate: "",
        film: "",
        Wm: "",
        Gs: "",
        coefficient: "0.400",
        absorption: "0.485",
        output: "",
      },
      up: {
        cropName: "å°éº¦",
        month: "4æœˆä»½",
        fertilizer: "",
        pesticide: "",
        area: "",
        irrigate: "",
        film: "",
        Wm: "",
        Gs: "",
        coefficient: "0.400",
        absorption: "0.485",
        output: "",
      },
      listData: [],
      calData: {
        cropName: "",
        month: "",
        emissionIntensity: 0,
        absorptionIntensity: 0,
        carbonSink: 0,
      },
      emiAdd: 0,
      absAdd: 0,
      carAdd: 0,
      updata: "",
      input: "",
      cropId: "",
      tableData: {},
      dialogFormTitle: "",
      dialogFormVisible: false,
      dialogFormVisible1: false,
      formLabelWidth: "120px",
      tableDatas: {
        // listdata:[],
        formdata: {},
        num: 0,
        total: "",
        size: 6,
        page: 0,
      },
      result: {
        cropName: "",
        month: "",
        emissionIntensity: 0,
        absorptionIntensity: 0,
        carbonSink: 0,
      },
    };
  },
  created() {
    // this.getAll();
  },
  methods: {
    resetForm(formName) {
      this.$refs[formName].resetFields();
    },
    getAll() {
      (this.tableDatas.page = this.tableDatas.num * this.tableDatas.size),
        console.log(this.tableDatas.num);
      axios
        .get(
          "http://localhost:8888/crop/pages?num=" +
            this.tableDatas.page +
            "&size=" +
            this.tableDatas.size
        )
        .then((res) => {
          console.log(res.data.records);
          this.listData = res.data.records;
          this.tableDatas.total = res.data.total;
        });
    },
    next() {
      if (this.tableDatas.num < this.tableDatas.total - 1) {
        this.tableDatas.num++;
      } else alert("å·²ç»æ˜¯æœ€åä¸€é¡µäº†");
      this.getAll();
    },
    upt() {
      if (this.tableDatas.page > 0) {
        this.tableDatas.num--;
      } else {
        alert("å·²ç»æ˜¯ç¬¬ä¸€é¡µäº†");
      }
      this.getAll();
    },
    handleEdit(index, row) {
      axios
        .get("http://localhost:8888/crop/selectId?id=" + row.cropId)
        .then((rel) => {
          this.up = rel.data;
        });
    },
    submitf() {
      this.result.cropName = this.add.cropName;
      this.result.month = this.add.month;
      this.result.emissionIntensity =
        this.add.fertilizer * this.a +
        this.add.pesticide * this.e +
        this.add.area * this.b +
        this.add.irrigate * this.c +
        this.add.film * this.d +
        this.add.Wm * this.f +
        this.add.Gs * this.g;
      this.result.absorptionIntensity =
        (this.add.output * this.add.absorption) / this.add.coefficient;
      this.result.carbonSink =
        this.result.absorptionIntensity - this.result.emissionIntensity;
      console.log(this.add);
      console.log(this.result);
      axios.post("http://localhost:8888/crop/save", this.result).then((rel) => {
        alert(
          "the process is: Et=Gf*a+Am*b+Gi*e+Ge*f+Gp*g+Wm*f+Gs*g=" +
            this.add.fertilizer +
            "*" +
            this.a +
            "+" +
            this.add.area +
            "*" +
            this.b +
            "+" +
            this.add.pesticide +
            "*" +
            this.e +
            "+" +
            this.add.irrigate +
            "*" +
            this.c +
            "+" +
            this.add.film +
            "*" +
            this.d +
            "+" +
            this.add.Wm +
            "*" +
            this.f +
            "+" +
            this.add.Gs +
            "*" +
            this.g +
            "=" +
            this.result.emissionIntensity +
            ";Ct=âˆ‘Cf*Yw/Hi=" +
            this.add.output +
            "*" +
            this.add.absorption +
            "/" +
            this.add.coefficient +
            "=" +
            this.result.absorptionIntensity +
            ";Nt=Ct-Et=" +
            this.result.absorptionIntensity +
            "-" +
            this.result.emissionIntensity +
            "=" +
            this.result.carbonSink
        );
        this.dialogFormVisible1 = false;
        this.getAll();
        this.resetForm("result");
        this.resetForm("add");
      });
    },
    updates() {
      this.result.cropName = this.up.cropName;
      this.result.month = this.up.month;
      this.result.emissionIntensity =
        this.up.fertilizer * this.a +
        this.up.pesticide * this.e +
        this.up.area * this.b +
        this.up.irrigate * this.c +
        this.up.film * this.d +
        this.up.Wm * this.f +
        this.up.Gs * this.g;
      this.result.absorptionIntensity =
        (this.up.output * this.up.absorption) / this.up.coefficient;
      this.result.carbonSink =
        this.result.absorptionIntensity - this.result.emissionIntensity;
      console.log(this.up);
      console.log(this.result);
      axios
        .get("http://localhost:8888/crop/selectId?id=" + this.up.cropId)
        .then((rel) => {
          console.log("back...");
          console.log(this.calData);
          console.log(rel.data);
          this.calData = rel.data;
          console.log("calData.data is:" + this.calData);
          this.emiAdd =
            this.result.emissionIntensity - this.calData.emissionIntensity;
          this.absAdd =
            this.result.absorptionIntensity - this.calData.absorptionIntensity;
          this.carAdd = this.result.carbonSink - this.calData.carbonSink;
          alert(
            this.calData.cropName +
              "å†œç”°ç”Ÿæ€ç³»ç»Ÿ" +
              this.up.month +
              "çš„ç¢³æ’æ”¾æ¯”" +
              this.calData.month +
              "å¢åŠ äº†" +
              this.emiAdd +
              "t," +
              "ç¢³å¸æ”¶å¢åŠ äº†" +
              this.absAdd +
              "t," +
              "ç¢³æ±‡å¢åŠ äº†" +
              this.absAdd +
              "t,"
          );
          this.dialogFormVisible = false;
          this.getAll();
          this.resetForm("result");
          this.resetForm("up");
        });
    },
    deletes(row) {
      axios.delete("http://localhost:8888/crop/" + row.cropId).then((res) => {
        alert(res.data);
        this.getAll();
      });
    },
    mohuSearch() {
      axios
        .get("http://localhost:8888/crop/like?cropName=" + this.input)
        .then((res) => {
          // this.searchdata.listData=res.data;
          this.listData = res.data;
          console.log(this.listData);
        });
    },
  },
};
</script>

<style lang="less" scoped>
* {
  margin: 0;
  padding: 0;
}
.cal{
  text-align: left;
}
.outerDiv {
  position: absolute;
  width: 100%;
  height: 100%;
  padding: 0;
  margin: 0;
  font-size: 16px;
  background-image: url("../../../assets/image/bg.png");
  background-repeat: no-repeat;
  background-size: 100% 100%;
}

.grid-container {
  display: grid;
  width: 100%;
  height: 100%;
  justify-content: center;
  align-content: center;
  grid-template-columns: 1fr 1fr 1fr;
  grid-template-rows: 2fr 3fr 3fr 1fr;
}
.grid-item:nth-child(1) {
  grid-column: 1 / span3;
  grid-row: 1 / 2;
}
.grid-item:nth-child(2) {
  grid-column: 1 / 2;
  grid-row: 2 / span2;
}
.grid-item:nth-child(3) {
  grid-column: 1 / 2;
  grid-row: 4 / 5;
}
.grid-item:nth-child(4) {
  grid-column: 2 / 3;
  grid-row: 2 / span2;
}
.grid-item:nth-child(5) {
  grid-column: 3 / 4;
  grid-row: 2 / 3;
}
.grid-item:nth-child(6) {
  grid-column: 3 / 4;
  grid-row: 3 / span2;
}

.header {
  color: white;
  text-align: center;
  line-height: 200px;
  border: 1px solid #dcdfe6;
  border-radius: 4px;
  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
  background-color: rgba(255, 255, 255, 0.2);
}
.headfont {
  margin: auto;
  font: bolder 6em STHupo;
  text-shadow: 0px 0px 0 rgba(149, 32, 32, 0.1),
    1px 1px 0 rgba(149, 32, 32, 0.1), 2px 2px 0 rgba(149, 32, 32, 0.1),
    3px 3px 0 rgba(149, 32, 32, 0.1), 4px 4px 0 rgba(149, 32, 32, 0.1),
    5px 5px 0 rgba(149, 32, 32, 0.1), 6px 6px 0 rgba(149, 32, 32, 0.1),
    7px 7px 0 rgba(149, 32, 32, 0.1), 8px 8px 0 rgba(149, 32, 32, 0.1),
    9px 9px 0 rgba(149, 32, 32, 0.1), 10px 10px 0 #952020, 11px 11px 0 #952020,
    12px 12px 0 #952020, 13px 13px 12px rgba(0, 0, 0, 0.55),
    13px 13px 1px rgba(0, 0, 0, 0.5);
}

.nb {
  float: right;
  margin: -8% -10% 0 20%;
  position: relative;
}

.loginBody {
  color: white;
  width: 350px;
  height: 350px;
  position: relative;
  align-items: center;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  margin: 10% -15% 4% 35%;
  padding: 50px 40px 20px 40px;
  border-radius: 30px;
  box-shadow: 20px 20px 50px rgb(149, 32, 32);
  opacity: 1;
  background: radial-gradient(rgba(172, 0, 0, 0.8), rgba(256, 136, 96, 0.8));
  z-index: 1000;
}

.genglu {
  text-shadow: 0 0 10px rgb(149, 32, 32);
  align-items: center;
  margin: 0 0 0 2%;
}
.submitBtn {
  background-color: transparent;
  color: white;
  width: 200px;
}

.pz {
  width: 600px;
  height: 300px;
  position: relative;
  color: white;
  margin: 0 0 0 -8%;
}
</style>

<style lang="less" scoped>
* {
  margin: 0;
  padding: 0;
}

.el-main {
  background-color: #e9eef3;
  color: #333;
}

.el-header {
  background-color: #545c64;
  color: #333;
  line-height: 60px;
  padding-left: 0px;
}

.logo {
  width: 200px;
  line-height: 60px;
  color: #fff;
  font-weight: bolder;
  padding-left: 50px;
  box-sizing: border-box;
  color: #1d953f;
}

.card-container {
  display: flex;
  height: 80px;
}

.ava {
  width: 80px;
  height: 80px;
  border-radius: 50%;
}

.admin-info h3 {
  margin-left: 24px;
  padding-top: 12px;
  margin-bottom: 12px;
}

.weather {
  margin-left: 24px;
}

.cell {
  display: flex;
}
</style>